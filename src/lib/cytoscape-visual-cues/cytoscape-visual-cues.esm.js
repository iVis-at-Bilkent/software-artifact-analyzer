import e from"html2canvas";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function t(e,t,i,n){return new(i||(i=Promise))((function(r,o){function a(e){try{s(n.next(e))}catch(e){o(e)}}function l(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,l)}s((n=n.apply(e,t||[])).next())}))}function i(e,t){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function n(e){return null==e}function r(e){return null!=e&&!isNaN(Number(e.toString()))}function o(e,t,i,n){var r=1-n,o=l(s(l(e,r),l(t,n)),r),a=l(s(l(t,r),l(i,n)),n);return s(o,a)}function a(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}}function l(e,t){return{x:e.x*t,y:e.y*t}}function s(e,t){return{x:e.x+t.x,y:e.y+t.y}}
/**
 * Finds the intersection point between the rectangle with parallel sides to the x and y
 * axes the half-line pointing towards (x,y) originating from the middle of the rectangle
 * Note: the function works given min[XY] <= max[XY],
 *       even though minY may not be the "top" of the rectangle
 *       because the coordinate system is flipped.
 * Note: if the input is inside the rectangle,
 *       the line segment wouldn't have an intersection with the rectangle,
 *       but the projected half-line does.
 * Warning: passing in the middle of the rectangle will return the midpoint itself
 *          there are infinitely many half-lines projected in all directions,
 *          so let's just shortcut to midpoint (GIGO).
 *
 * @param p :x,y coordinates of the point to build the half-line from
 * @param b :bounding box representing rectangle
 * @return an object with x and y members for the intersection
 * @throws if validate == true and (x,y) is inside the rectangle
 * @author TWiStErRob
 * @licence Dual CC0/WTFPL/Unlicence, whatever floats your boat
 * @see <a href="http://stackoverflow.com/a/31254199/253468">source</a>
 * @see <a href="http://stackoverflow.com/a/18292964/253468">based on</a>
 */function u(e,t){var i=e.x,n=e.y,r=Math.min(t.x1,t.x2),o=Math.min(t.y1,t.y2),a=Math.max(t.x1,t.x2),l=Math.max(t.y1,t.y2),s=(r+a)/2,u=(o+l)/2,c=(u-n)/(s-i);if(i<=s){var d=c*(r-i)+n;if(o<=d&&d<=l)return{x:r,y:d}}if(i>=s){var h=c*(a-i)+n;if(o<=h&&h<=l)return{x:a,y:h}}if(n<=u){var f=(o-n)/c+i;if(r<=f&&f<=a)return{x:f,y:o}}if(n>=u){var m=(l-n)/c+i;if(r<=m&&m<=a)return{x:m,y:l}}if(i===s&&n===u)return{x:i,y:n};throw"Cannot find intersection for "+[i,n]+" inside rectangle "+[r,o]+" - "+[a,l]+"."}var c="style mouseover mouseout select unselect",d={},h=1;function f(e){r(e.marginX)&&(e.marginX=Number(e.marginX)),r(e.marginY)&&(e.marginY=Number(e.marginY))}function m(e,t){if(e.segmentPoints())return function(e,t){var i=e.renderedSegmentPoints();if("target"==t){var n=e.target().renderedBoundingBox({includeLabels:!1,includeOverlays:!1});return u(i[i.length-1],n)}if("source"==t){n=e.source().renderedBoundingBox({includeLabels:!1,includeOverlays:!1});return u(i[0],n)}var r=Math.floor(i.length/2);if(i.length%2==0){return a(i[r],i[r-1])}return i[r]}(e,t);if(e.controlPoints())return function(e,t){var i=e.renderedControlPoints();if("target"==t){var n=e.target().renderedBoundingBox({includeLabels:!1,includeOverlays:!1});return u(i[i.length-1],n)}if("source"==t){n=e.source().renderedBoundingBox({includeLabels:!1,includeOverlays:!1});return u(i[0],n)}var r=Math.floor(i.length/2);if(i.length%2==0){return a(i[r],i[r-1])}var l=e.renderedSourceEndpoint(),s=e.renderedTargetEndpoint();r>0&&(l=i[r-1]);r<i.length-1&&(s=i[r+1]);var c=.5;if(1==i.length)return c=Number(e.css("control-point-weights")),o(l,i[r],s,c);return o(a(l,i[r]),i[r],a(i[r],s),c)}(e,t);if("center"!=t){var i={};i="source"==t?e.source().renderedBoundingBox({includeLabels:!1,includeOverlays:!1}):e.target().renderedBoundingBox({includeLabels:!1,includeOverlays:!1});return u("source"==t?e.renderedTargetEndpoint():e.renderedSourceEndpoint(),i)}}function g(e,t){var i={x:0,y:0};if(t.isNode()){var n=t.renderedBoundingBox({includeLabels:!1,includeOverlays:!1});if("number"==typeof e.marginX)i.x=e.marginX;else if("string"==typeof e.marginX){var r=Number(e.marginX.substring(1))/100*n.w;i.x=r}if("number"==typeof e.marginY)i.y=e.marginY;else if("string"==typeof e.marginY){var o=Number(e.marginY.substring(1))/100*n.h;i.y=o}}else{var a=t.renderedTargetEndpoint(),l=t.renderedSourceEndpoint(),s=a.y-l.y,u=a.x-l.x,c=Math.atan(s/u),d=Math.sqrt(s*s+u*u),h=Math.sin(c),f=Math.cos(c),m=u>0?1:-1;if("number"==typeof e.marginX)i.y+=e.marginX*h,i.x+=e.marginX*f;else if("string"==typeof e.marginX){var g=d*(Number(e.marginX.substring(1))/100);i.y+=g*h,i.x+=g*f}var v=t.renderedWidth();if("number"==typeof e.marginY)i.x+=e.marginY*h,i.y+=e.marginY*f;else if("string"==typeof e.marginY){g=v*(Number(e.marginY.substring(1))/100);i.x+=g*h,i.y+=g*f}i.x*=m,i.y*=m}return i}function v(e,t){var i=e.isNode();if(i&&("target"==t||"source"==t))throw"'"+t+"' is invalid cue position for a node";if(!i&&"target"!=t&&"source"!=t&&"center"!=t)throw"'"+t+"' is invalid cue position for an edge"}function y(e,t,i){var n=t/2*1,r=e.graphElem.renderedBoundingBox({includeLabels:!1,includeOverlays:!1}),o=e.graphElem.isEdge();for(var a in e.cues){i&&(a=i);var l=e.cues[a],s=l.htmlElem.clientWidth,u=l.htmlElem.clientHeight,c=l.position,d=(r.y1+r.y2)/2-u/2,h=(r.x2+r.x1)/2-s/2;if("bottom"==c||"bottom-left"==c||"bottom-right"==c?d=r.y2-u/2:"top"!=c&&"top-left"!=c&&"top-right"!=c||(d=r.y1-u/2),"right"==c||"top-right"==c||"bottom-right"==c?h=r.x2-s/2:"left"!=c&&"top-left"!=c&&"bottom-left"!=c||(h=r.x1-s/2),o){var f=m(e.graphElem,c);f&&(h=f.x-s/2,d=f.y-u/2)}var v=g(l,e.graphElem);h+=v.x,d+=v.y;var y="scale("+n+")";if(l.isFixedSize&&(y=""),l.htmlElem.style.transform="translate("+h+"px, "+d+"px) "+y,i)return}}function p(e,t,i){for(var n in e)i?(t[n]=e[n].htmlElem.style.visibility,e[n].htmlElem.style.visibility="hidden"):e[n].htmlElem.style.visibility=t[n]}function b(e,t){for(var i=e.children(),n=0;n<i.length;n++){var r=i[n];if(r.isParent())b(r,t);else{var o=d[h][r.id()];o&&y(o,t)}}}function x(e,t){var i=e.target,n=i.id();if(d[h]&&d[h][n]){var r=d[h][n].cues,o=e.type,a=i.selected();if(i.visible()){var l=i.cy().zoom();for(var s in"mouseover"==o&&function(){for(var e in d[h])for(var t in d[h][e].cues)"hover"==d[h][e].cues[t].show&&(d[h][e].cues[t].htmlElem.style.visibility="hidden")}(),r){t&&(s=t);var u=r[s].show;if(l<=r[s].zoom2hide||"never"==u?r[s].htmlElem.style.visibility="hidden":"always"==u||"hover"==u&&"mouseover"==o?r[s].htmlElem.style.visibility="visible":"over"==u?"mouseout"==o?r[s].htmlElem.style.visibility="hidden":"mouseover"==o&&(r[s].htmlElem.style.visibility="visible"):"select"==u&&("select"==o||a?r[s].htmlElem.style.visibility="visible":"unselect"==o&&(r[s].htmlElem.style.visibility="hidden")),t)return}}else for(var s in r)r[s].htmlElem.style.visibility="hidden"}}function w(e){var t=e.target.id();if(d[h][t]){var i=d[h][t].cues;for(var n in i)i[n].htmlElem.remove();d[h][t].positionFn&&(d[h][t].graphElem.isEdge()?(d[h][t].graphElem.source().off("position",d[h][t].positionFn),d[h][t].graphElem.target().off("position",d[h][t].positionFn)):d[h][t].graphElem.off("position",d[h][t].positionFn),d[h][t].graphElem.off(c,d[h][t].styleFn),e.target.cy().off("pan zoom resize",d[h][t].positionFn)),delete d[h][t]}}function E(e,t,i){var n=e.cy().zoom(),r=e.id();y(d[h][r],n),b(e,n),i&&p(d[h][r].cues,t,!1)}function C(e){e.preventDefault(),e.stopPropagation()}function z(e,t){for(var i in t){if("htmlElem"==i||"imgData"==i)throw"'htmlElem' and 'imgData' cannot be updated! Please try removing whole cue and then adding it again";e[i]=t[i],"tooltip"==i&&(e.htmlElem.title=t[i]),"zIndex"==i&&(e.htmlElem.style.zIndex=t[i]+""),"cursor"==i&&(e.htmlElem.style.cursor=t[i]+"")}}function B(e,t,i){var n="hidden";i&&(n="visible");for(var r=0;r<e.length;r++){var o=e[r].id();if(d[h][o])if(void 0!==t&&null!=t){var a=d[h][o].cues[t];a?a.htmlElem.style.visibility=n:console.error("Can not found a cue with id: ",t)}else{var l=d[h][o].cues;for(var s in l)l[s].htmlElem.style.visibility=n}}}function D(){d[h]||(d[h]={})}function M(e){var t,i,r;D();var o,a=this,l=this.cy(),s=l.container();(o=e).show||(o.show="always"),n(o.isFixedSize)&&(o.isFixedSize=!1),n(o.marginX)&&(o.marginX=0),n(o.marginY)&&(o.marginY=0),n(o.zoom2hide)&&(o.zoom2hide=0),n(o.tooltip)&&(o.tooltip=""),n(o.cursor)&&(o.cursor="initial");for(var u=[],m=function(o){var m=function(e){var t={id:e.id,show:e.show,position:e.position,marginX:e.marginX,marginY:e.marginY,onCueClicked:e.onCueClicked,htmlElem:e.htmlElem?e.htmlElem.cloneNode(!0):e.htmlElem,imgData:null,zoom2hide:e.zoom2hide,isFixedSize:e.isFixedSize,zIndex:e.zIndex,tooltip:e.tooltip,cursor:e.cursor};return f(t),e.imgData&&(t.imgData={src:e.imgData.src,width:e.imgData.width,height:e.imgData.height}),t}(e),g=a[o],y=g.id()+"";if(v(g,m.position),function(e,t){if(!n(t.id)&&""!=t.id){var i=e.id();if(d[h][i]&&d[h][i].cues[t.id])return!0}return!1}(g,m))return console.error("A cue with id '"+m.id+"' already exists for '"+y+"'"),u.push(!1),"break";u.push(!0);var b=void 0;m.imgData?((b=document.createElement("img")).width=null===(t=m.imgData)||void 0===t?void 0:t.width,b.height=null===(i=m.imgData)||void 0===i?void 0:i.height,b.src=null===(r=m.imgData)||void 0===r?void 0:r.src,m.htmlElem=b):b=m.htmlElem,function(e,t,i,n){e.appendChild(t),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex=i.zIndex,t.title=i.tooltip,t.style.cursor=i.cursor,"always"!=i.show&&(t.style.visibility="hidden"),t.addEventListener("click",(function(){i.onCueClicked&&i.onCueClicked(n,i.id)})),t.addEventListener("mousedown",C),t.addEventListener("mouseup",C),t.addEventListener("touchstart",C),t.addEventListener("touchend",C)}(s,b,m,g);var z,B,D,M,X,Y={},L=!1,k=(z=function(){L=!1,d[h]&&d[h][y]&&(E(g,Y,!0),x({target:g,type:"position"}))},B=100,D=function(){L=!0,d[h]&&d[h][y]&&p(d[h][y].cues,Y,!0)},X=!0,function(){var e=this,t=arguments,i=function(){M=null,z.apply(e,t),X=!0};clearTimeout(M),M=setTimeout(i,B),X&&(D.apply(e,t),X=!1)}),F=function(e,t){void 0===t&&(t=void 0),L||x(e,t)},I=d[h][y];if(I){if(n(O=m.id)||""==O)for(O=0;I.cues[O];)O++;I.cues[O]=m}else{var O;!function(e,t,i,n){e.isEdge()?(e.source().on("position",i),e.target().on("position",i)):e.on("position",i),e.on(c,n),e.on("remove",w),t.on("pan zoom resize",i)}(g,l,k,F),(n(O=m.id)||""==O)&&(O=0);var N={};N[O]=m,d[h][y]={cues:N,graphElem:g,positionFn:k,styleFn:F}}E(g,Y,!1)},g=0;g<a.length;g++){if("break"===m(g))break}return u}function X(e){D();for(var t=0;t<this.length;t++){var i=this[t],r=i.id();if(!d[h][r])break;if(n(e))w({target:i});else{var o=d[h][r].cues[e];o?(o.htmlElem.remove(),delete d[h][r].cues[e],Object.keys(d[h][r].cues).length<1&&w({target:i})):console.warn("Can not found a cue with id '"+e+"'")}}}function Y(e){D();var t=this.cy(),i=e.id;f(e);for(var n=0;n<this.length;n++){var r=e,o=this[n],a=o.id();if(d[h][a]){var l=d[h][a].cues[i];if(v(o,r.position),l)z(d[h][a].cues[i],e);else{var s=d[h][a].cues;for(var u in s)z(d[h][a].cues[u],e)}y(d[h][a],t.zoom(),i),x({target:o,type:"style"},i)}}}function L(){D();for(var e={},t=0;t<this.length;t++){var i=this[t].id();d[h]&&d[h][i]&&(e[i]=d[h][i].cues)}return e}function k(e){D();B(this,e,!1)}function F(e){D();B(this,e,!0)}function I(e){h=e}function O(){return h}function N(e){return new Promise((function(t,i){var n=new Image;n.src=e,n.onload=function(){return t(n)},n.onerror=function(e){console.error("Error loading image:",e),i("Error loading image")}}))}function S(n,r){return void 0===r&&(r=[]),t(this,void 0,void 0,(function(){var t,o,a,l,s,u,c,d,h,f,v,y,p,b,x,w,E,C,z,B,D,M,X,Y,L,k,F,I,O,S,W,P,T,H,j,A,R,U,q,G,J;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,13,,14]),t=this,o=document.createElement("canvas"),a=o.getContext("2d"),[4,N(t.png(n))];case 1:if(l=i.sent(),s=t.elements(),u=t.elements().renderedBoundingBox(),!(c=document.getElementById("cy")))throw new Error("Container element not found.");for(d=t.zoom()/2,h=0,f=[],v=0,y=s;v<y.length;v++)for(L=y[v],k=L.getCueData(),p=0,b=Object.values(k);p<b.length;p++)for(T in O=b[p])O.hasOwnProperty(T)&&(H=O[T]).htmlElem&&(x=L.renderedBoundingBox({includeLabels:!1,includeOverlays:!1}),w=L.isEdge(),E=H.htmlElem.offsetWidth*d,C=H.htmlElem.offsetHeight*d,z=H.position,R=(x.x2+x.x1)/2-E/2,U=(x.y1+x.y2)/2-C/2,z.startsWith("bottom")?U=x.y2-C/2:z.startsWith("top")&&(U=x.y1-C/2),z.endsWith("right")?R=x.x2-E/2:z.endsWith("left")&&(R=x.x1-E/2),w&&(B=m(L,z))&&(R=B.x-E/2,U=B.y-C/2),D=g(H,L),R+=D.x*d,U+=D.y*d,f.push({cueX:R,cueY:U}),z.startsWith("bottom")?h=Math.max(h,Math.abs(x.y2-U)):z.startsWith("top")&&(h=Math.max(h,Math.abs(U-x.y1))),z.endsWith("right")?h=Math.max(h,Math.abs(R-x.x2)):z.endsWith("left")&&(h=Math.max(h,Math.abs(R-x.x1))));if(n.full?h*=Math.max(l.width/u.w,l.height/u.h):h=0,o.width=l.width+2*h,o.height=l.height+2*h,!a)throw new Error("Unable to obtain 2D context for canvas.");a.fillStyle=n.bg,a.fillRect(0,0,o.width,o.height),a.drawImage(l,h,h,l.width,l.height),M=0,X=0,Y=s,i.label=2;case 2:if(!(X<Y.length))return[3,12];L=Y[X],k=L.getCueData(),F=0,I=Object.values(k),i.label=3;case 3:if(!(F<I.length))return[3,11];for(W in O=I[F],S=[],O)S.push(W);P=0,i.label=4;case 4:if(!(P<S.length))return[3,10];if(T=S[P],!O.hasOwnProperty(T))return[3,9];if(!(H=O[T]).htmlElem)return[3,9];i.label=5;case 5:return i.trys.push([5,8,,9]),j=H.htmlElem,[4,e(j,{scale:n.scale*(n.full?1/d:1),ignoreElements:function(e){return r.some((function(t){return e.classList.contains(t)}))},backgroundColor:"transparent"})];case 6:return[4,N(i.sent().toDataURL())];case 7:return A=i.sent(),R=f[M].cueX,U=f[M].cueY,q=void 0,G=void 0,n.full?(q=(R-(u.x1+u.x2)/2)*l.width/u.w,G=(U-(u.y1+u.y2)/2)*l.height/u.h,a.drawImage(A,q+l.width/2+h,G+l.height/2+h,d/n.scale*A.width*l.width/u.w,d/n.scale*A.height*l.height/u.h)):(q=R*l.width/c.offsetWidth,G=U*l.height/c.offsetHeight,console.log(),a.drawImage(A,q,G,1/n.scale*A.width*l.width/c.offsetWidth,1/n.scale*A.height*l.height/c.offsetHeight)),M+=1,[3,9];case 8:return J=i.sent(),console.error("Error processing image:",J),[3,9];case 9:return P++,[3,4];case 10:return F++,[3,3];case 11:return X++,[3,2];case 12:return[2,o.toDataURL()];case 13:throw i.sent();case 14:return[2]}}))}))}function W(e){e&&(e("collection","addCue",M),e("collection","removeCue",X),e("collection","updateCue",Y),e("collection","getCueData",L),e("collection","showCue",F),e("collection","hideCue",k),e("core","setActiveCueInstance",I),e("core","getActiveCueInstanceId",O),e("core","pngFull",S))}void 0!==window.cytoscape&&W(window.cytoscape);export{W as default};
