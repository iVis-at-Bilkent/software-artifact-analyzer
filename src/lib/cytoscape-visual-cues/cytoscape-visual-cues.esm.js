function e(e){return null==e}function i(e){return null!=e&&!isNaN(Number(e.toString()))}function t(e,i,t,n){var l=1-n,a=r(o(r(e,l),r(i,n)),l),s=r(o(r(i,l),r(t,n)),n);return o(a,s)}function n(e,i){return{x:(e.x+i.x)/2,y:(e.y+i.y)/2}}function r(e,i){return{x:e.x*i,y:e.y*i}}function o(e,i){return{x:e.x+i.x,y:e.y+i.y}}
/**
 * Finds the intersection point between the rectangle with parallel sides to the x and y
 * axes the half-line pointing towards (x,y) originating from the middle of the rectangle
 * Note: the function works given min[XY] <= max[XY],
 *       even though minY may not be the "top" of the rectangle
 *       because the coordinate system is flipped.
 * Note: if the input is inside the rectangle,
 *       the line segment wouldn't have an intersection with the rectangle,
 *       but the projected half-line does.
 * Warning: passing in the middle of the rectangle will return the midpoint itself
 *          there are infinitely many half-lines projected in all directions,
 *          so let's just shortcut to midpoint (GIGO).
 *
 * @param p :x,y coordinates of the point to build the half-line from
 * @param b :bounding box representing rectangle
 * @return an object with x and y members for the intersection
 * @throws if validate == true and (x,y) is inside the rectangle
 * @author TWiStErRob
 * @licence Dual CC0/WTFPL/Unlicence, whatever floats your boat
 * @see <a href="http://stackoverflow.com/a/31254199/253468">source</a>
 * @see <a href="http://stackoverflow.com/a/18292964/253468">based on</a>
 */function l(e,i){var t=e.x,n=e.y,r=Math.min(i.x1,i.x2),o=Math.min(i.y1,i.y2),l=Math.max(i.x1,i.x2),a=Math.max(i.y1,i.y2),s=(r+l)/2,u=(o+a)/2,d=(u-n)/(s-t);if(t<=s){var c=d*(r-t)+n;if(o<=c&&c<=a)return{x:r,y:c}}if(t>=s){var m=d*(l-t)+n;if(o<=m&&m<=a)return{x:l,y:m}}if(n<=u){var f=(o-n)/d+t;if(r<=f&&f<=l)return{x:f,y:o}}if(n>=u){var h=(a-n)/d+t;if(r<=h&&h<=l)return{x:h,y:a}}if(t===s&&n===u)return{x:t,y:n};throw"Cannot find intersection for "+[t,n]+" inside rectangle "+[r,o]+" - "+[l,a]+"."}var a="style mouseover mouseout select unselect",s={},u=1;function d(e){i(e.marginX)&&(e.marginX=Number(e.marginX)),i(e.marginY)&&(e.marginY=Number(e.marginY))}function c(e,i){if(e.segmentPoints())return function(e,i){var t=e.renderedSegmentPoints();if("target"==i){var r=e.target().renderedBoundingBox({includeLabels:!1,includeOverlays:!1});return l(t[t.length-1],r)}if("source"==i){r=e.source().renderedBoundingBox({includeLabels:!1,includeOverlays:!1});return l(t[0],r)}var o=Math.floor(t.length/2);if(t.length%2==0){return n(t[o],t[o-1])}return t[o]}(e,i);if(e.controlPoints())return function(e,i){var r=e.renderedControlPoints();if("target"==i){var o=e.target().renderedBoundingBox({includeLabels:!1,includeOverlays:!1});return l(r[r.length-1],o)}if("source"==i){o=e.source().renderedBoundingBox({includeLabels:!1,includeOverlays:!1});return l(r[0],o)}var a=Math.floor(r.length/2);if(r.length%2==0){return n(r[a],r[a-1])}var s=e.renderedSourceEndpoint(),u=e.renderedTargetEndpoint();a>0&&(s=r[a-1]);a<r.length-1&&(u=r[a+1]);var d=.5;if(1==r.length)return d=Number(e.css("control-point-weights")),t(s,r[a],u,d);return t(n(s,r[a]),r[a],n(r[a],u),d)}(e,i);if("center"!=i){var r={};r="source"==i?e.source().renderedBoundingBox({includeLabels:!1,includeOverlays:!1}):e.target().renderedBoundingBox({includeLabels:!1,includeOverlays:!1});return l("source"==i?e.renderedTargetEndpoint():e.renderedSourceEndpoint(),r)}}function m(e,i){var t={x:0,y:0};if(i.isNode()){var n=i.renderedBoundingBox({includeLabels:!1,includeOverlays:!1});if("number"==typeof e.marginX)t.x=e.marginX;else if("string"==typeof e.marginX){var r=Number(e.marginX.substring(1))/100*n.w;t.x=r}if("number"==typeof e.marginY)t.y=e.marginY;else if("string"==typeof e.marginY){var o=Number(e.marginY.substring(1))/100*n.h;t.y=o}}else{var l=i.renderedTargetEndpoint(),a=i.renderedSourceEndpoint(),s=l.y-a.y,u=l.x-a.x,d=Math.atan(s/u),c=Math.sqrt(s*s+u*u),m=Math.sin(d),f=Math.cos(d),h=u>0?1:-1;if("number"==typeof e.marginX)t.y+=e.marginX*m,t.x+=e.marginX*f;else if("string"==typeof e.marginX){var v=c*(Number(e.marginX.substring(1))/100);t.y+=v*m,t.x+=v*f}var g=i.renderedWidth();if("number"==typeof e.marginY)t.x+=e.marginY*m,t.y+=e.marginY*f;else if("string"==typeof e.marginY){v=g*(Number(e.marginY.substring(1))/100);t.x+=v*m,t.y+=v*f}t.x*=h,t.y*=h}return t}function f(e,i){var t=e.isNode();if(t&&("target"==i||"source"==i))throw"'"+i+"' is invalid cue position for a node";if(!t&&"target"!=i&&"source"!=i&&"center"!=i)throw"'"+i+"' is invalid cue position for an edge"}function h(e,i,t){var n=i/2*1,r=e.graphElem.renderedBoundingBox({includeLabels:!1,includeOverlays:!1}),o=e.graphElem.isEdge();for(var l in e.cues){t&&(l=t);var a=e.cues[l],s=a.htmlElem.clientWidth,u=a.htmlElem.clientHeight,d=a.position,f=(r.y1+r.y2)/2-u/2,h=(r.x2+r.x1)/2-s/2;if("bottom"==d||"bottom-left"==d||"bottom-right"==d?f=r.y2-u/2:"top"!=d&&"top-left"!=d&&"top-right"!=d||(f=r.y1-u/2),"right"==d||"top-right"==d||"bottom-right"==d?h=r.x2-s/2:"left"!=d&&"top-left"!=d&&"bottom-left"!=d||(h=r.x1-s/2),o){var v=c(e.graphElem,d);v&&(h=v.x-s/2,f=v.y-u/2)}var g=m(a,e.graphElem);h+=g.x,f+=g.y;var y="scale("+n+")";if(a.isFixedSize&&(y=""),a.htmlElem.style.transform="translate("+h+"px, "+f+"px) "+y,t)return}}function v(e,i,t){for(var n in e)t?(i[n]=e[n].htmlElem.style.visibility,e[n].htmlElem.style.visibility="hidden"):e[n].htmlElem.style.visibility=i[n]}function g(e,i){for(var t=e.children(),n=0;n<t.length;n++){var r=t[n];if(r.isParent())g(r,i);else{var o=s[u][r.id()];o&&h(o,i)}}}function y(e,i){var t=e.target,n=t.id();if(s[u]&&s[u][n]){var r=s[u][n].cues,o=e.type,l=t.selected();if(t.visible()){var a=t.cy().zoom();for(var d in"mouseover"==o&&function(){for(var e in s[u])for(var i in s[u][e].cues)"hover"==s[u][e].cues[i].show&&(s[u][e].cues[i].htmlElem.style.visibility="hidden")}(),r){i&&(d=i);var c=r[d].show;if(a<=r[d].zoom2hide||"never"==c?r[d].htmlElem.style.visibility="hidden":"always"==c||"hover"==c&&"mouseover"==o?r[d].htmlElem.style.visibility="visible":"over"==c?"mouseout"==o?r[d].htmlElem.style.visibility="hidden":"mouseover"==o&&(r[d].htmlElem.style.visibility="visible"):"select"==c&&("select"==o||l?r[d].htmlElem.style.visibility="visible":"unselect"==o&&(r[d].htmlElem.style.visibility="hidden")),i)return}}else for(var d in r)r[d].htmlElem.style.visibility="hidden"}}function p(e){var i=e.target.id();if(s[u][i]){var t=s[u][i].cues;for(var n in t)t[n].htmlElem.remove();s[u][i].positionFn&&(s[u][i].graphElem.isEdge()?(s[u][i].graphElem.source().off("position",s[u][i].positionFn),s[u][i].graphElem.target().off("position",s[u][i].positionFn)):s[u][i].graphElem.off("position",s[u][i].positionFn),s[u][i].graphElem.off(a,s[u][i].styleFn),e.target.cy().off("pan zoom resize",s[u][i].positionFn)),delete s[u][i]}}function x(e,i,t){var n=e.cy().zoom(),r=e.id();h(s[u][r],n),g(e,n),t&&v(s[u][r].cues,i,!1)}function b(e){e.preventDefault(),e.stopPropagation()}function E(e,i){for(var t in i){if("htmlElem"==t||"imgData"==t)throw"'htmlElem' and 'imgData' cannot be updated! Please try removing whole cue and then adding it again";e[t]=i[t],"tooltip"==t&&(e.htmlElem.title=i[t]),"zIndex"==t&&(e.htmlElem.style.zIndex=i[t]+""),"cursor"==t&&(e.htmlElem.style.cursor=i[t]+"")}}function w(e,i,t){var n="hidden";t&&(n="visible");for(var r=0;r<e.length;r++){var o=e[r].id();if(s[u][o])if(void 0!==i&&null!=i){var l=s[u][o].cues[i];l?l.htmlElem.style.visibility=n:console.error("Can not found a cue with id: ",i)}else{var a=s[u][o].cues;for(var d in a)a[d].htmlElem.style.visibility=n}}}function z(){s[u]||(s[u]={})}function C(i){var t,n,r;z();var o,l=this,c=this.cy(),m=c.container();(o=i).show||(o.show="always"),e(o.isFixedSize)&&(o.isFixedSize=!1),e(o.marginX)&&(o.marginX=0),e(o.marginY)&&(o.marginY=0),e(o.zoom2hide)&&(o.zoom2hide=0),e(o.tooltip)&&(o.tooltip=""),e(o.cursor)&&(o.cursor="initial");for(var h=[],g=function(o){var g=function(e){var i={id:e.id,show:e.show,position:e.position,marginX:e.marginX,marginY:e.marginY,onCueClicked:e.onCueClicked,htmlElem:e.htmlElem?e.htmlElem.cloneNode(!0):e.htmlElem,imgData:null,zoom2hide:e.zoom2hide,isFixedSize:e.isFixedSize,zIndex:e.zIndex,tooltip:e.tooltip,cursor:e.cursor};return d(i),e.imgData&&(i.imgData={src:e.imgData.src,width:e.imgData.width,height:e.imgData.height}),i}(i),E=l[o],w=E.id()+"";if(f(E,g.position),function(i,t){if(!e(t.id)&&""!=t.id){var n=i.id();if(s[u][n]&&s[u][n].cues[t.id])return!0}return!1}(E,g))return console.error("A cue with id '"+g.id+"' already exists for '"+w+"'"),h.push(!1),"break";h.push(!0);var z=void 0;g.imgData?((z=document.createElement("img")).width=null===(t=g.imgData)||void 0===t?void 0:t.width,z.height=null===(n=g.imgData)||void 0===n?void 0:n.height,z.src=null===(r=g.imgData)||void 0===r?void 0:r.src,g.htmlElem=z):z=g.htmlElem,function(e,i,t,n){e.appendChild(i),i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.zIndex=t.zIndex,i.title=t.tooltip,i.style.cursor=t.cursor,"always"!=t.show&&(i.style.visibility="hidden"),i.addEventListener("click",(function(){t.onCueClicked&&t.onCueClicked(n,t.id)})),i.addEventListener("mousedown",b),i.addEventListener("mouseup",b),i.addEventListener("touchstart",b),i.addEventListener("touchend",b)}(m,z,g,E);var C,B,X,Y,D,F={},L=!1,N=(C=function(){L=!1,s[u]&&s[u][w]&&(x(E,F,!0),y({target:E,type:"position"}))},B=100,X=function(){L=!0,s[u]&&s[u][w]&&v(s[u][w].cues,F,!0)},D=!0,function(){var e=this,i=arguments,t=function(){Y=null,C.apply(e,i),D=!0};clearTimeout(Y),Y=setTimeout(t,B),D&&(X.apply(e,i),D=!1)}),k=function(e,i){void 0===i&&(i=void 0),L||y(e,i)},M=s[u][w];if(M){if(e(S=g.id)||""==S)for(S=0;M.cues[S];)S++;M.cues[S]=g}else{var S;!function(e,i,t,n){e.isEdge()?(e.source().on("position",t),e.target().on("position",t)):e.on("position",t),e.on(a,n),e.on("remove",p),i.on("pan zoom resize",t)}(E,c,N,k),(e(S=g.id)||""==S)&&(S=0);var I={};I[S]=g,s[u][w]={cues:I,graphElem:E,positionFn:N,styleFn:k}}x(E,F,!1)},E=0;E<l.length;E++){if("break"===g(E))break}return h}function B(i){z();for(var t=0;t<this.length;t++){var n=this[t],r=n.id();if(!s[u][r])break;if(e(i))p({target:n});else{var o=s[u][r].cues[i];o?(o.htmlElem.remove(),delete s[u][r].cues[i],Object.keys(s[u][r].cues).length<1&&p({target:n})):console.warn("Can not found a cue with id '"+i+"'")}}}function X(e){z();var i=this.cy(),t=e.id;d(e);for(var n=0;n<this.length;n++){var r=e,o=this[n],l=o.id();if(s[u][l]){var a=s[u][l].cues[t];if(f(o,r.position),a)E(s[u][l].cues[t],e);else{var c=s[u][l].cues;for(var m in c)E(s[u][l].cues[m],e)}h(s[u][l],i.zoom(),t),y({target:o,type:"style"},t)}}}function Y(){z();for(var e={},i=0;i<this.length;i++){var t=this[i].id();s[u]&&s[u][t]&&(e[t]=s[u][t].cues)}return e}function D(e){z();w(this,e,!1)}function F(e){z();w(this,e,!0)}function L(e){u=e}function N(){return u}function k(e){e&&(e("collection","addCue",C),e("collection","removeCue",B),e("collection","updateCue",X),e("collection","getCueData",Y),e("collection","showCue",F),e("collection","hideCue",D),e("core","setActiveCueInstance",L),e("core","getActiveCueInstanceId",N))}void 0!==window.cytoscape&&k(window.cytoscape);export{k as default};
